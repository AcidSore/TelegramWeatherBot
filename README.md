# Smart weather telegram bot
### Название задачи и выбранный уровень сложности
"Умный сервис прогноза погоды", уровень сложности: 
- сервис получает от пользователя данные о том, погода в каком городе его интересует, данные о местонахождении пользователь должен указывать самостоятельно в поле ввода;
- сервис дает рекоммендации в соответствии с прогнозом погоды.

### Проектирование сервиса
**Технологии:** NodeJS, Docker, Docker-Compose

**Пользовательский интерфейс:** Telegram inline-бот (язык интерфейса: Английский)

**Формат ответа:**

```
Название города

Минималльная температура, Максимальная температура
Описание погоды (Дождь, Облачно, др.)

Умный совет от бота в соответствии с погодой:
 - совет 1
 - совет 2
 ...
```
**Демонстрация сервиса:** Для демонстрации сервиса достаточно начать свое сообщение в любом чате мессенджера Telegram с имени запущенного мною бота `@MyForecasterBot`

### Процесс работы программы
1. Программа соединяется с серверами мессенджера Telegram и подписывается на получение событий ранее зарегистрированного Telegram-бота.
2. Пользователь в мессенджере Telegram в любом чате начинает писать имя бота, и затем сервис предлагает ему продолжить сообщение названием города.
3. После ввода пользователем города, программа получает событие от серсиса Telegram с введенным пользователем городом.
4. Программа создает и отправляет запрос по API к сервису, предоставляющему прогноз погоды (openweathermap.org).
5. Программа обрабатывает ответ с прогнозом погоды и на основании его формирует сообщение пользователю в мессенджер Telegram.
6. Пользователь может в любое время обновить данные о погоде в городе, отображенные ботом ранее в сообщении, нажатимем кнопки в сообщении.

### Запуск программы
#### Получение ключей сервисов
Для работы программы необходимо получить TOKEN-ы двух сервисов:
- Telegram Bot Token
- openweathermap.org API TOKEN
#### Запуск программы с помощью Docker-Compose
Для запуска программы с использованием `Docker-Compose` необходимо установить на рабочей машине (сервере) утилиты: `docker` и `docker-compose`.

Необходимо создать `.env`-файл по аналогии с примером `.env.example` и заполнить его корректными ключами (см раздел выше - получение ключей сервисов), разместить его рядом с примером.
```
# запуск приложения:
# make up

# остановить приложение
# make down

# пересобрать приложение и запустить
# make rebuild
```
#### Запуск программы без Docker-Compose

Запуск программы производится в каталоге `src`.

Для запуска программы необходимо установить пакетный менеджер `npm` и `nodejs`.

Пример команд для Linux Ubuntu:
```
# установка пакетного менеджера npm
# apt-get install npm

# установка nodejs
# apt-get install nodejs

# проверка версии установленного nodejs
# nodejs -v

# обновление версии nodejs до последней стабильной
# sudo npm cache clean -f
# npm config set strict-ssl false
# sudo npm install -g n
# sudo n stable

# проверка версии nodejs
# node -v
```

Необходимо установить пакеты, используемые программой:
```
# npm i
```

Для корректной работы программы необходимо задать переменные окружения `TELEGRAM` и `WEATHER`, соответствующие токенам этих сервисов. Это можно сделать командами:
```
# export TELEGRAM=<YOUR TELEGRAM BOT TOKEN>
# export WEATHER=<YOUR TOKEN FROM openweathermap.org>
```

Запуск программы:
```
# node bot.js
```
